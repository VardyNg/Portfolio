<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Making your first Phaser 3 Game - Part 1</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

    var config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        physics: {
        default: 'arcade',
            arcade: {
                gravity: { y: 200 },
                debug: true
            }
        },
        scene: {
            preload: preload,
            create: create
        },
        backgroundColor: 0xC0C0C0
    };

    var game = new Phaser.Game(config);

    function preload ()
    {
        this.load.spritesheet('button', 'assets/packet.png', { frameWidth: 80, frameHeight: 20 });
        this.load.spritesheet('mouse', 'assets/mouse.png', { frameWidth: 80, frameHeight: 20 });

        this.load.bitmapFont('nokia', 'assets/fonts/bitmap/nokia16black.png', 'assets/fonts/bitmap/nokia16black.xml');

    }

    function create ()
    {
        //let txt = this.add.bitmapText(10,10, 'nokia', "---", 16);

        for (let i = 0; i < 10; i++)
        {
            spriteName = "test"+ i;

            makeButton.call(this, spriteName, 100 + i*65, 115);
        }


        //makePhysicsButton.call(this, spriteName, 200, 200);

        this.input.on('gameobjectover', function (pointer, button)
        {
            //setButtonFrame(button, 0);
        });
        this.input.on('gameobjectout', function (pointer, button)
        {
            //setButtonFrame(button, 1);
        });
        this.input.on('gameobjectdown', function (pointer, button)
        {
            if (button.texture.key == "mouse")
            {
                button.setTexture('button');
            }
        }, this);
        this.input.on('gameobjectup', function (pointer, button)
        {
            //setButtonFrame(button, 0);
        });

    }

    function makeButton(name, x, y)
    {
        var button = this.add.image(x, y, 'mouse', 1).setInteractive();        
        button.name = name;
        button.setScale(2, 1.5);

        //var text = this.add.bitmapText(x - 40, y - 8, 'nokia', name, 16);
        //text.x += (button.width - text.width) / 2;
    }

    function makePhysicsButton(name, x, y)
    {
        var button = this.add.image(0, 0, 'button', 1);
        button.setScale(2, 1.5);

        var text = this.add.bitmapText(-40, -8, 'nokia', name, 16);
        text.x += (button.width - text.width) / 2;

        let container = this.add.container(x,y, [button, text]);
        this.physics.world.enable(container);
        container.setSize(80,64);
        container.body.setVelocity(100, 200).setBounce(1, 1).setCollideWorldBounds(true);
        container.name = name;
        container.setInteractive()
        //this.input.setDraggable(container.setInteractive());
        
        this.input.setDraggable(container);

        this.input.on('dragstart', function (pointer, obj)
        {
            obj.body.moves = false;
        });

        this.input.on('drag', function (pointer, obj, dragX, dragY)
        {
            obj.setPosition(dragX, dragY);
        });

        this.input.on('dragend', function (pointer, obj)
        {
            obj.body.moves = true;
        });
    }

    function setButtonFrame(button, frame)
    {
        button.frame = button.scene.textures.getFrame('button', frame);
    }

</script>

</body>
</html>